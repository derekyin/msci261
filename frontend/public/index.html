<!doctype html>
<html lang="en">
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<!-- Bootstrap CSS -->
		
		<title>MSCI 261 Project</title>
	</head>
	<body>
        <div class="container" id="app">
            <form v-on:submit="processStocks">
                <h2>Enter stock info</h2>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1">$</span>
                    </div>
                    <input v-model="inputa" type="text" id="inputa" class="form-control" placeholder="Stock A Ticker" aria-describedby="basic-addon1">
                </div>

                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon2">$</span>
                    </div>
                    <input v-model="inputb" type="text" id="inputb" class="form-control" placeholder="Stock B Ticker" aria-describedby="basic-addon1">
                </div>
                <b-button :disabled="workingOnStocks" v-on:click="processStocks" variant="primary" size="lg" type="submit" id="submitbutton" class="mb-3">Submit</b-button>
            </form>

            <div v-if="show1" id="output1">
                <b-table striped hover :items="stocksTable"></b-table>
        
                <h2>MVP portfolio</h2>
                <b-table striped hover :items="mvpTable"></b-table>

                <h2>Cases</h2>
                <b-table striped hover :items="caseTable"></b-table>
            </div>
        </div>

        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/vue@2.6.10/dist/vue.min.js"></script>
        <script src="https://unpkg.com/vue-router/dist/vue-router.min.js"></script>
        <script src="https://unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
        <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>

        <script>
            window.app = new Vue({
              el: '#app',
              data: {
                  inputa: '',
                  inputb: '',
                  workingOnStocks: false,
                  workingOnRandomPortfolio: false,
                  show1: false,
                  show2: false,
                  stocksTable: [],
                  mvpTable: [],
                  caseTable: [],
              },
              computed: {
              },
              mounted: function() {
              },
              watch:{
              },
              methods:{
                processStocks: function(){
                    this.workingOnStocks = true;
                    const data = {
                        a: this.inputa,
                        b: this.inputb
                    }

                    var settings = {
                        "async": true,
                        "crossDomain": true,
                        "url": "/stocks",
                        "method": "POST",
                        "headers": {
                            "Content-Type": "application/json",
                            },
                        "processData": false,
                        "data": JSON.stringify(data)
                    }

                    $.ajax(settings).done(function (response) {
                        window.app.workingOnStocks = false;

                        window.app.stocksTable = [];
                        for(row of response.stocks){
                            window.app.stocksTable.push({
                                ticker: row.ticker.toUpperCase(),
                                daily_return: (Math.round(row.mean_daily * 100000) / 1000).toString() + "%",
                                annual_return: (Math.round(row.mean_annual * 1000) / 10).toString() + "%",
                                standard_deviation: (Math.round(row.sd * 1000) / 10).toString() + "%"
                            });
                        }

                        window.app.mvpTable = [];
                        window.app.mvpTable.push({
                            proportion_stock_a: (Math.round(response.mvp.prop_a * 1000) / 10).toString() + "%",
                            proportion_stock_b: (Math.round(response.mvp.prop_b * 1000) / 10).toString() + "%",
                            annual_return: (Math.round(response.mvp["return"] * 1000) / 10).toString() + "%",
                            standard_deviation: (Math.round(response.mvp.sd * 1000) / 10).toString() + "%"
                        });

                        window.app.caseTable = [];
                        for(row of response.cml){
                            window.app.caseTable.push({
                                proportion_risk_free: (Math.round(row.prop_rf * 100)).toString() + "%",
                                proportion_market: (Math.round(row.prop_market * 100)).toString() + "%",
                                sharpe_ratio: row.sharpe ? Math.round(row.sharpe * 10) / 10 : '',
                                annual_return: (Math.round(row.annual_return * 1000) / 10).toString() + "%",
                                standard_deviation: (Math.round(row.sd * 1000) / 10).toString() + "%"
                            });
                        }
                        window.app.show1 = true;
                    });
                }
              }
            });

 
        </script>
        <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css"/>
        <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.css"/>
	</body>
</html>
